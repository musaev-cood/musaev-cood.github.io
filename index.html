<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no">
    <title>GoyMarket</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="style.css" rel="stylesheet">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<link href="https://fonts.googleapis.com/css2?family=Shantell+Sans:ital,wght@0,300..800;1,300..800&family=Yanone+Kaffeesatz:wght@300&display=swap" rel="stylesheet">
</head>
<body>

    <header>
        <h1>GoyMarket - Ваш магазин продуктов</h1>
    </header>

    <section>
        <div class="product" onclick="rotateAnimation(this)">
            <img src="https://www.otlichnye-tseny.ru/upload/iblock/f62/iqdhjkrb30c15qpwlrply3gh6jv6f0ey.jpg" alt="Product 3">
            <h3 class="product-title">Спрайт</h3>
            <p class="product-price">32 ₽</p>
            <button class="add-to-cart-button" onclick=AddToCartButton(this)>ДОБАВИТЬ</button>
            <button class="delete-to-cart-button" style="display:none;" onclick=deleteFromCartButton(this)>-</button>
            <div class="quantity" style="display:none;">0</div>
        </div>

        <div class="product" onclick="rotateAnimation(this)">
            <img src="https://www.otlichnye-tseny.ru/upload/iblock/f62/iqdhjkrb30c15qpwlrply3gh6jv6f0ey.jpg" alt="Product 3">
            <h3 class="product-title">Спрайт</h3>
            <p class="product-price">32 ₽</p>
            <button class="add-to-cart-button" onclick=AddToCartButton(this)>ДОБАВИТЬ</button>
            <button class="delete-to-cart-button" style="display:none;" onclick=deleteFromCartButton(this)>-</button>
            <div class="quantity" style="display:none;">0</div>
        </div>

        <div class="product" onclick="rotateAnimation(this)">
            <img src="https://www.otlichnye-tseny.ru/upload/iblock/f62/iqdhjkrb30c15qpwlrply3gh6jv6f0ey.jpg" alt="Product 3">
            <h3 class="product-title">Спрайт</h3>
            <p class="product-price">32 ₽</p>
            <button class="add-to-cart-button" onclick=AddToCartButton(this)>ДОБАВИТЬ</button>
            <button class="delete-to-cart-button" style="display:none;" onclick=deleteFromCartButton(this)>-</button>
            <div class="quantity" style="display:none;">0</div>
        </div>
    </section>

    <footer>
        <button id="cart-button" onclick="showCart()"> <img src="https://cdn-icons-png.flaticon.com/512/15/15278.png" alt="Shopping Cart"></button>
        <p>&copy; 2024 GoyMarket. V1.1. Все права защищены.</p>
    </footer>

<script>
    let WebApp = window.Telegram.WebApp;
    function AddToCartButton(element) {
        WebApp.HapticFeedback.impactOccurred("rigid")
        const deleteButton = element.nextElementSibling;
        const quantityElement = element.nextElementSibling.nextElementSibling;

        deleteButton.style.display = 'inline-block';
        quantityElement.style.display = 'inline-block';

        let currentQuantity = parseInt(quantityElement.textContent, 10) || 0;

        if (currentQuantity === 0){
            quantityElement.classList.add('fade-in');
            setTimeout(() => {
                quantityElement.classList.remove('fade-in');
            }, 200);

            deleteButton.style.transition = 'padding 0.2s';
            element.textContent = "+";
            element.style.fontWeight = 800;
            element.style.padding = '.3em 3em calc(.3em + 3px)';

            setTimeout(() => {
                deleteButton.style.padding = '.3em 1.25em calc(.3em + 3px)';
                deleteButton.style.opacity = 1;
                element.style.padding = '.3em 1em calc(.3em + 3px)';
            }, 100);

        }else{
            quantityElement.classList.add('bounce-in');
            setTimeout(() => {
                quantityElement.classList.remove('bounce-in');
            }, 100);
        }

        if (currentQuantity<9){
            quantityElement.textContent = currentQuantity + 1;
        }
    }
    function deleteFromCartButton(element) {
        WebApp.HapticFeedback.impactOccurred("light")

        const quantityElement = element.nextElementSibling;
        const addButton = element.previousElementSibling;

        let currentQuantity = parseInt(quantityElement.textContent, 10) || 0;
        quantityElement.textContent = Math.max(0, currentQuantity - 1).toString();

        if (currentQuantity <= 1) {
            quantityElement.classList.add('fade-out');
            addButton.style.transition = 'padding 0.15s';
            element.style.transition = 'padding 0.15s';
            element.style.transition = 'opacity 0.2s';

            element.style.display = 'none';
            addButton.style.fontWeight = 800;
            element.style.padding = '.3em 0.1em calc(.3em + 3px)';
            element.style.opacity = 0;
            addButton.style.padding = '.3em 3em calc(.3em + 3px)';
            
            setTimeout(() => {
                setTimeout(() => {
                    addButton.textContent = "ДОБАВИТЬ";
                    quantityElement.classList.remove('fade-out');
                    quantityElement.style.display = 'none';
                }, 100);
                addButton.style.padding = '.3em 0.7em calc(.3em + 3px)';
            }, 50);

        }else{
            quantityElement.classList.add('bounce-out');
            setTimeout(() => {
                quantityElement.classList.remove('bounce-out');
            }, 100);
        }
    }
    function rotateAnimation(element) {
        let clickedElement = event.target;

        // Check if the click event originated from the image
        if (clickedElement.tagName.toLowerCase() === 'img') {
            let img = element.querySelector('img');

            if (!img.classList.contains('rotate')) {
                img.classList.add('rotate');

                setTimeout(function () {
                    img.classList.remove('rotate');
                }, 500);
            }
        }
    }
</script>
</body>
</html>
